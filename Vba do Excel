Sub AdicionarLAMBDAS()
'
' Macro para Adicionar formulas padrões
'

'

'' Transforma Juros Mensal para Anual
    ActiveWorkbook.Names.Add Name:="JurosMes_Ano", RefersToR1C1:= _
        "=LAMBDA(Juros_Mensal,(1+Juros_Mensal)^12-1)"
        
'' Transforma Juros Mensal para Diário
    ActiveWorkbook.Names.Add Name:="JurosMes_Dia", RefersToR1C1:= _
        "=LAMBDA(Juros_Mensal,(1+Juros_Mensal)^(1/30)-1)"
        
'' Transforma Juros Anual para Mensal
    ActiveWorkbook.Names.Add Name:="JurosAno_Mês", RefersToR1C1:= _
        "=LAMBDA(Juros_Anual,(1+Juros_Anual)^(1/12)-1)"
        
'' Transforma Juros Anual para Diário
    ActiveWorkbook.Names.Add Name:="JurosAno_Dia", RefersToR1C1:= _
        "=LAMBDA(Juros_Anual,(1+Juros_Anual)^(1/252)-1)"
        
 '' Transforma Juros Dia para Mensal
    ActiveWorkbook.Names.Add Name:="JurosDia_Mês", RefersToR1C1:= _
        "=LAMBDA(Juros_Diario,(1+Juros_Diario)^(30)-1)"
        
'' Transforma Juros Dia para Anual
    ActiveWorkbook.Names.Add Name:="JurosDia_Ano", RefersToR1C1:= _
        "=LAMBDA(Juros_Diario,(1+Juros_Diario)^(252)-1)"
        
'' Transforma Juros para um Período especificado em Input
    ActiveWorkbook.Names.Add Name:="Juros_Periodo", RefersToR1C1:= _
        "=LAMBDA(Juros, Periodo,  (1+Juros)^(Periodo)-1)"
        
'' Calcula valor final com juros compostos constante e carência
    ActiveWorkbook.Names.Add Name:="ValorJC", RefersToR1C1:= _
        "=LAMBDA(ValorInicial,Parcelas,Carência,TaxaJuros,-PMT(TaxaJuros,Parcelas,ValorInicial*(1+TaxaJuros)^Carência)*Parcelas)"
        
'' Calcula os valores dos impostos PIS e COFINS no Lucro Real de um Valor Bruto
    ActiveWorkbook.Names.Add Name:="CalcImpostoLucroReal", RefersToR1C1:= _
        "=LAMBDA(ValorBruto, LET(ordem, {1;2;3}, nomes,{""PIS"";""COFINS"";""TOTAL""}, AliquotaReal,{0.0165;0.076;0.0925}, Valor,ValorBruto, Resultado,AliquotaReal*Valor, RetornaCol(SORT(CHOOSE(SEQUENCE(1,3),ordem, nomes,Resultado),1),{2;3})))"
        
'' Calcula os valores dos impostos PIS e COFINS no Lucro Presumido de um Valor Bruto
    ActiveWorkbook.Names.Add Name:="CalcImpostoLucroPresumido", RefersToR1C1:= _
        "=LAMBDA(ValorBruto, LET(ordem, {1;2;3}, nomes,{""PIS"";""COFINS"";""TOTAL""}, AliquotaPres,{0.0065;0.03;0.0365}, Valor,ValorBruto, Resultado,AliquotaPres*Valor, RetornaCol(SORT(CHOOSE(SEQUENCE(1,3),ordem, nomes,Resultado),1),{2;3})))"
    
'' Lista e conta as repetições de valores unicos em uma faixa de dados
    ActiveWorkbook.Names.Add Name:="ContUnicos", RefersToR1C1:= _
        "=LAMBDA(Dados,LET(Dados,FILTER(Dados,(Dados<>""""),),ListaCompleta,TRIM(Dados),ListaUnicos,SORT(UNIQUE(ListaCompleta)),Contagem,BYROW(ListaUnicos,LAMBDA(DadoLinha,REDUCE(0,ListaCompleta,LAMBDA(acc,texto,IF(texto=DadoLinha,acc+1,acc))))), SORT(CHOOSE(SEQUENCE(1,2),ListaUnicos,Contagem),1)))"
    
'' Retorna a/as linhas de uma Matriz
    ActiveWorkbook.Names.Add Name:="RetornaLin", RefersToR1C1:= _
        "=LAMBDA(Matriz,Lin,INDEX(Matriz,Lin,SEQUENCE(,COLUMNS(Matriz))))"

'' Retorna a/as colunas de uma Matriz
    ActiveWorkbook.Names.Add Name:="RetornaCol", RefersToR1C1:= _
        "=LAMBDA(Matriz,Col,INDEX(Matriz,SEQUENCE(ROWS(Matriz)),TRANSPOSE(Col)))"

'' Calcula o faturamento da BaoBing por OS por cidade no modelo do Boletim do mês de Julho (se o boletim mudar, a formula pode não funcionar
    ActiveWorkbook.Names.Add Name:="FaturamentoBaoBing", RefersToR1C1:= _
        "=LAMBDA(Dados,ValorFaturamento, LET( Dados,FILTER(Dados,(Dados<>"""")*(Dados<>""Cidade""),), ListaCompleta,TRIM(Dados), ListaUnicos,SORT(UNIQUE(ListaCompleta)), Contagem,BYROW(ListaUnicos,LAMBDA(DadoLinha,REDUCE(0,ListaCompleta,LAMBDA(acc,texto,IF(texto=DadoLinha,acc+1,acc))))), ValorUnitarioOS,TRUNC(ValorFaturamento/SUM(Contagem),2), SORT(CHOOSE(SEQUENCE(1,2),Lista" & _
        "Unicos,Contagem*ValorUnitarioOS),1)))"
        
'' Junta 2 Colunas para formar uma única matriz
    ActiveWorkbook.Names.Add Name:="Juntar2Col", RefersToR1C1:= _
        "=LAMBDA(Matriz1,Matriz2, LET( MatrizOrdenadora,SEQUENCE(ROWS(Matriz1),1,,0), MatrizJunta,SORT(CHOOSE(SEQUENCE(1,3),MatrizOrdenadora,Matriz1,Matriz2),1), INDEX(MatrizJunta,SEQUENCE(ROWS(MatrizJunta)),{2,3}) ))"
        
'' Calcula o Breakeven baseado em um Fluxo de Faturamento Mensal (Encontra o primeiro mês de lucro)
    ActiveWorkbook.Names.Add Name:="BreakEvenFluxo", RefersToR1C1:= _
        "=LAMBDA(FluxoMensal, SUM(IF(FluxoMensal>0,0,1))+1)"
        
        
'' Calcula o Juros total multiplicando uma sequência de juros em períodos iguais
    ActiveWorkbook.Names.Add Name:="JurosTotal", RefersToR1C1:= _
        "=LAMBDA(DadosEntrada, LET( ArrTxMensal,DadosEntrada, REDUCE(1,ArrTxMensal,LAMBDA(Acc,Taxa,Acc*(1+Taxa)))-1))"
        
End Sub

Sub ChangeCellColor()

    Dim cell As Range
    
    For Each cell In Selection.Cells
        If Not IsError(cell.Value) Then
            If Len(cell.Value) > 0 Then
                If cell.HasFormula = False Then
                    cell.Font.Color = vbBlue ' Cell is a constant
                ElseIf InStr(cell.Formula, "(") > 0 Or InStr(cell.Formula, ")") > 0 Or InStr(cell.Formula, "+") > 0 Or InStr(cell.Formula, "-") > 0 Or InStr(cell.Formula, "*") > 0 Or InStr(cell.Formula, "^") > 0 Or InStr(cell.Formula, "&") > 0 Or InStr(cell.Formula, "/") > 0 Then
                    cell.Font.Color = vbBlack ' Cell is a reference to another cell
                ElseIf cell.HasFormula Then
                    cell.Font.Color = RGB(34, 139, 34) ' Cell has a formula
                Else
                
                End If
            End If
        End If
    Next cell

End Sub
